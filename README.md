# Java内存
## 1. 运行时数据区域介绍
### 程序计数器
当前线程所之行的字节码的行号指示器。各条线程之间计数器互不影响，独立存储。
### Java虚拟机栈
线程私有。   
虚拟机栈描述的时Java方法之行的内存模型：每个方法在执行时都会创建一个栈帧用语存储局部变量表，操作数栈，动态链接，方法出口等信息。
### 本地方法栈
和虚拟机栈功能相识，只为本地方法栈服务对象时Native方法。
### Java堆
被所有线程共享的一块内存区域，唯一目的就时存放对象实例。
### 方法区
被所有线程共享的一块内存区域，用于存储已被虚拟机加载的类信息，常量，静态变量，即时编译器编译后的代码等数据。
(运行时常量池, 是方法区的一部分，用于存放编译期声称的各种字面量和符号引用。)

## 2. HotSpot虚拟机对象探密
### 对象的创建
首先检查是否已经被加载，解析和初始化   
接下来虚拟机将为新生对象分配内存（两种方法：指针碰撞，空闲列表）   
#### 当分配空间过程中遇到多线程问题的解决方法：
1. 分配对象用同步处理
2. 把内存分配的动作按照线程划分在不痛的空间之中进行，称为本地线程分配缓冲
   
接下来将分配到的内存空间都初始化为零   
最后要对对象进行必要的设置：设置合适的信息到对象的对象头（Object Header）

### 对象的内存布局
* 对象头（根据对象的状态服用自己的存储空间）
* 实例数据（程序代码中所定义的各种类型的字段内容）
* 对齐填充（不是必然存在，作用是占位，使对象大小为8字节的整数倍）

### 对象的访问定位
* 句柄（reference -> 句柄池 -> 对象实例数据&对象类型数据）
* 直接指针（reference -> 对象实例数据 -> 对象类型数据）
